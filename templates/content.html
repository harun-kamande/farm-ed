{% extends 'home.html' %}

{% block content %}
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <!-- Navigation Bar -->
      <ul class="nav nav-pills justify-content-center mb-4">
        <li class="nav-item">
          <a href="{{ url_for('dailyFarming') }}" class="nav-link">Dairy Farming</a>
        </li>
        <li class="nav-item">
          <a href="{{ url_for('coffee') }}" class="nav-link">Coffee</a>
        </li>
        <li class="nav-item">
          <a href="{{ url_for('tea') }}" class="nav-link">Tea</a>
        </li>
        <li class="nav-item">
          <a href="{{ url_for('maize_farming') }}" class="nav-link">Maize Farming</a>
        </li>
        <li class="nav-item">
          <a href="{{ url_for('others') }}" class="nav-link">Others</a>
        </li>
      </ul>

      <!-- Posts Section -->
      {% if posts %}
      {% for post in posts %}
      <div class="card mb-4">
        <div class="card-body {% if post[0] == id %}bg-success text-white{% else %}bg-light{% endif %}">
          <h5 class="card-title">{{ post[2] }}</h5>
          <h6 class="card-subtitle mb-2 text-muted">{{ post[4] }} by {{ post[1] }}</h6>
          <p class="card-text">{{ post[3] }}</p>
          {% if post[7] %}
          <div class="mb-3">
            {% if post[7].endswith('.jpg') or post[7].endswith('.png') %}
            <img src="{{ url_for('static', filename='uploads/' ~ post[7]) }}" class="img-fluid rounded" alt="Image">
            {% elif post[7].endswith('.mp4') %}
            <video controls class="img-fluid rounded">
              <source src="{{ url_for('static', filename='uploads/' ~ post[7]) }}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
            {% endif %}
          </div>
          {% endif %}
          <div class="d-flex justify-content-center align-items-center">
            <p class="mx-3">Likes: {{ post[6] }}</p>
            <!-- Like Post Form -->
            <form action="{{ url_for('like') }}" method="post" class="mx-3">
              <input type="hidden" id="post_id" name="post_id" value="{{ post[5] }}" />
              <button type="submit" class="btn btn-primary">Like</button>
            </form>

            <!-- Reply Section -->
            <div class="mx-3">
              <button class="toggle-btn btn btn-primary" onclick="toggleVisibility(this)" type="button">Reply</button>
              <div style="display: none;" class="giving mt-2">
                <form action="{{ url_for('reply') }}" method="post">
                  <input type="text" id="post_id" name="post_id" value="{{ post[5] }}" hidden>
                  <textarea class="textarea bg-light rounded mt-2" name="reply" id="reply"
                    placeholder="Input"></textarea>
                  <input type="submit" class="btn btn-primary mt-2" value="Submit">
                </form>
              </div>
            </div>

            <!-- View Replies Section -->
            <div class="mx-3">
              <button class="toggle-btn btn btn-info" onclick="toggleVisibility(this)" type="button">View
                Replies</button>
              <div style="display: none;" class="giving mt-2">
                {% for reply in replies %}
                {% if reply[2] == post[5] %}
                <div class="container-fluid bg-primary rounded mb-2 p-2">
                  <p>Reply by {{ reply[3] }}</p>
                  <hr>
                  <p>{{ reply[1] }}</p>
                </div>
                {% endif %}
                {% endfor %}
              </div>
            </div>

            <!-- Edit and Delete Post Section -->
            {% if post[0] == id %}
            <div class="mx-3">
              <button class="toggle-btn btn btn-warning" onclick="toggleVisibility(this)" type="button">Edit</button>
              <div style="display: none;" class="giving mt-2">
                <form action="{{ url_for('edit') }}" method="post">
                  <input type="text" id="post_id" name="post_id" value="{{ post[5] }}" hidden>
                  <textarea class="textarea bg-light rounded mt-2" name="post_update" id="post_update"
                    placeholder="Input">{{ post[3] }}</textarea>
                  <input type="submit" class="btn btn-warning mt-2" value="Submit">
                </form>
              </div>
            </div>

            <form action="{{ url_for('delete_post') }}" method="post" class="mx-3">
              <input type="hidden" name="id" value="{{ post[5] }}" />
              <button type="submit" onclick="deleted_alert()" class="btn btn-danger">Delete</button>
            </form>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
      {% else %}
      <p>No posts available.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}